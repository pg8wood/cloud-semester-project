<?xml version="1.0" encoding="UTF-8"?>
<!--
Created by Patrick Gatewood on 2017.04.08 
Copyright Â© 2017 Patrick Gatewood. All rights reserved.
-->
<!DOCTYPE html [
    <!ENTITY nbsp "&#160;">
    ]>
    <html xmlns="http://www.w3.org/1999/xhtml"
          xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
          xmlns:h="http://xmlns.jcp.org/jsf/html"
          xmlns:f="http://xmlns.jcp.org/jsf/core"
          xmlns:p="http://primefaces.org/ui">

        <ui:composition>
            <!-- CSS for meetings -->
            <h:head>
                <h:outputStylesheet library="css" name="meetingStyles.css" />
            </h:head>

            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.2/css/font-awesome.min.css" />

            <h:form id="test#{meetingInvitation.id}" >
            <div id="meetingWrapper#{meetingInvitation.id}" class="meetingWrapper" align="center">
                <!-- Meeting Invitation Preview with Respond Button -->
                <h2>#{meetingInvitation.topic}</h2>
                <p style="text-align: center">#{meetingInvitation.description}</p>
                <p:commandButton widgetVar="respondButton#{meetingInvitation.id}" value="Respond" onclick="PF('respondButton#{meetingInvitation.id}').disable(); PF('dayPanel#{meetingInvitation.id}').expand()" styleClass="commandButton"/>

                <!-- Response section: user indicates their availability date-wise -->
                <p:panel class="dayPanel#{meetingInvitation.id}" toggleable="true" closable="true" toggleSpeed="500" closeSpeed="500" collapsed="#{!meetingController.shouldHideTimeForMeeting(meetingInvitation)}" widgetVar="dayPanel#{meetingInvitation.id}" styleClass="noBorderPanel">
                    <hr />
                    <h4>When can you make it?</h4>
                    <!-- Can't go button --> 
                    <p:commandLink class="declineLink">
                        <i id="declineIcon#{meetingInvitation.id}" class="fa fa-times" aria-hidden="true" onclick="hideInvitation('meetingWrapper#{meetingInvitation.id}')"></i>
                        <div class="declineText">Can't go</div>
                    </p:commandLink>

                    <!-- Div that floats left in order to force #horizontalScrollArea
                    to fill the content width up to #declineLine -->
                    <div style="float: left;"></div>

                    <!-- TODO make one button and get suggested dates from Meeting object.
                    Also give user a hint that this area is scrollable.-->
                    <p:scrollPanel id="horizontalScrollArea#{meetingInvitation.id}" styleClass="horizontalScrollArea" mode="native">
<!--                         Link to be rendered if the user shows a new date 
                        <p:panel id="newDatePanel#{meetingInvitation.id}" toggleable="true" closable="true" collapsed="true">
                            <p:commandLink id="newDateCalendarLink#{meetingInvitation.id}" class="calendarLink" onclick="PF('timePanel#{meetingInvitation.id}').show()" >
                                <time datetime="2014-01-01" class="icon">
                                    <em>TEST</em>
                                    <strong>TEST</strong>
                                    <span>TEST</span>
                                </time>
                            </p:commandLink>
                        </p:panel>-->

                        <!-- Get list of times for the selected meetingInvitation -->
                        <ui:param name="times" value="#{meetingController.getMeetingFacade().getTimeslotsForMeeting(meetingInvitation)}" />

                        <p:repeat value="#{meetingController.getUniqueDateListForMeeting(meetingInvitation)}" offset="0" step="1" size="#{meetingController.getUniqueDateListForMeeting(meetingInvitation).size()}" var="timeslot" varStatus="status"> 
                            <!-- Clicking this link updates the collapsed time panel and displays it -->
                            <p:commandLink class="calendarLink" action="#{meetingController.setSelectedDate(timeslot, component.namingContainer.parent.namingContainer.clientId, meetingInvitation)}" oncomplete="PF('timePanel#{meetingInvitation.id}').expand()" process="@all" ajax="true" update="#{component.namingContainer.parent.namingContainer.clientId}">
                                <!--<f:ajax render="#{component.namingContainer.parent.namingContainer.clientId}:timePanel" />-->
                                <!--<f:ajax render="@all"/>-->
                                <time datetime="" class="icon">
                                    <em>#{meetingController.getDayOfWeek(timeslot.getDay())}</em>
                                    <strong>#{meetingController.getMonthName(timeslot.getMonth())}</strong>
                                    <span>#{timeslot.getDate()}</span>
                                </time>
                            </p:commandLink>
                        </p:repeat>
                    </p:scrollPanel>

<!--                     Create new date 
                    <br />
                    <p:outputLabel for="event" value="New date: " />
                    &nbsp;&nbsp;
                    <p:calendar id="event#{meetingInvitation.id}" value="#{myMeetingsController.newDate}">
                        <p:ajax event="dateSelect" listener="#{myMeetingsController.onDateSelect}" async="true" oncomplete="showNewDate()" update="newDatePanel" />
                    </p:calendar>-->

                    <!-- Function to show the newly-added date -->
<!--                    <script type="text/javascript">
                        function showNewDate() {
                            $('#newDatePanel#{meetingInvitation.id}').addClass('newDatePanel');
                        }
                    </script>-->
                </p:panel>  <!-- .dayPanel -->

                <!-- Available time options shown after the user selects a date --> 
                <p:panel rendered="true" toggleable="true" closable="true" toggleSpeed="500" closeSpeed="500" collapsed="#{!meetingController.shouldHideTimeForMeeting(meetingInvitation)}" widgetVar="timePanel#{meetingInvitation.id}" styleClass="noBorderPanel">
                    <br />
                    <hr />

                    <p:panelGrid id="timePanel#{meetingInvitation.id}" columns="4" columnClasses="columnOne, columnTwo, columnOne, columnTwo" styleClass="availableTimesTable">
                        <!--<h:form id="test#{meetingInvitation.id}">-->
                            <p:repeat value="#{meetingController.getTimesForDay(times, meetingController.selectedDate)}" offset="0" step="1" size="#{meetingController.getTimesForDay().size()}" var="timeslot" varStatus="status"> 
                             <!-- On/Off switch --> 
                            <div style="height: 3em;">
                                <label class="switch">
                                    <input type="checkbox" />
                                    <div class="slider round"></div>
                                </label>
                                &nbsp;
                                <h:outputText styleClass="onOffLabel" value="#{meetingController.getMeetingFacade().getMeetingString(timeslot)}"></h:outputText>
                            </div>
                        </p:repeat>
                        <!--</h:form>-->
                    </p:panelGrid>

                    <br />  

<!--                    <p:outputLabel value="Enter new time" for="newTime" />
                    &nbsp;
                    <p:inputText id="newTime#{meetingInvitation.id}" value=""
                                 required="false" styleClass="" label="New Time">
                    </p:inputText>-->

                    <br/>
                    <p:commandButton value="Submit all selected times" onclick="hideInvitation('meetingWrapper#{meetingInvitation.id}')" styleClass="commandButton"></p:commandButton>
                    &nbsp;&nbsp;
                    <p:commandButton value="I can't make it" onclick="hideInvitation('meetingWrapper#{meetingInvitation.id}')" styleClass="commandButton"></p:commandButton>


                    <!-- Hide the invitation after the user has submitted -->
                    <script type="text/javascript">
                        function hideInvitation(id) {
                            var e = document.getElementById(id);
                            e.innerHTML = '<p>You have submitted your response for this invitation.</p>';
                        }
                    </script>
                </p:panel> <!-- .timePanel -->
            <!--</h:form>-->
            </div> <!-- #meetingWrapper -->
            </h:form>

        </ui:composition>
    </html>
